generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Page {
  id        Int       @id @default(autoincrement())
  slug      String?   @unique
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  name      String
  sections  Section[]
  seo       PageSeo?

  @@index([slug])
}

model Section {
  id           Int                    @id @default(autoincrement())
  name         String
  pageId       Int
  createdAt    DateTime               @default(now())
  updatedAt    DateTime               @updatedAt
  page         Page                   @relation(fields: [pageId], references: [id], onDelete: Cascade)
  translations SectionTranslation[]
  lazyLoading  SeoSectionLazyLoading?

  @@unique([pageId, name])
  @@index([pageId])
}

model SectionTranslation {
  id        Int      @id @default(autoincrement())
  sectionId Int
  locale    String
  content   Json
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  section   Section  @relation(fields: [sectionId], references: [id], onDelete: Cascade)

  @@unique([sectionId, locale])
  @@index([locale])
}

model globals {
  id           Int                  @id @default(autoincrement())
  name         String
  createdAt    DateTime             @default(now())
  updatedAt    DateTime             @updatedAt
  translations globalsTranslation[]
}

model globalsTranslation {
  id        Int      @id @default(autoincrement())
  globalsId Int
  locale    String
  content   Json
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  globals   globals  @relation(fields: [globalsId], references: [id], onDelete: Cascade)

  @@unique([globalsId, locale])
  @@index([locale])
}

model Video {
  id            Int       @id @default(autoincrement())
  title         String
  description   String?
  embedUrl      String
  videoType     VideoType @default(VIDEO)
  categoryId    Int?
  datePublished DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  category      Category? @relation(fields: [categoryId], references: [id])
  products      Product[] @relation("ProductVideos")
  tags          Tag[]     @relation("VideoTags")

  @@index([datePublished])
}

model Tag {
  id            Int            @id @default(autoincrement())
  name          String
  type          TagType
  products      Product[]      @relation("ProductTags")
  videos        Video[]        @relation("VideoTags")
  youtubeVideos YouTubeVideo[] @relation("YouTubeVideoTags")

  @@unique([name, type])
  @@index([type])
}

model Brand {
  id            Int            @id @default(autoincrement())
  name          String         @unique
  slug          String         @unique
  products      Product[]
  youtubeVideos YouTubeVideo[]

  @@index([slug])
  @@index([name])
}

model Product {
  id           Int                  @id @default(autoincrement())
  sku          String               @unique
  brandId      Int
  isActive     Boolean              @default(true)
  createdAt    DateTime             @default(now())
  updatedAt    DateTime             @updatedAt
  brand        Brand                @relation(fields: [brandId], references: [id])
  images       ProductImage[]
  translations ProductTranslation[]
  categories   Category[]           @relation("ProductCategories")
  tags         Tag[]                @relation("ProductTags")
  videos       Video[]              @relation("ProductVideos")

  @@index([brandId])
  @@index([sku])
  @@index([createdAt])
  @@index([isActive])
}

model Category {
  id            Int            @id @default(autoincrement())
  name          String
  type          CategoryType   @default(PRODUCT)
  videos        Video[]
  products      Product[]      @relation("ProductCategories")
  youtubeVideos YouTubeVideo[] @relation("YouTubeVideoCategories")

  @@index([type])
  @@index([name])
}

model ProductTranslation {
  id             Int      @id @default(autoincrement())
  productId      Int
  locale         String
  name           String
  slug           String
  description    String
  seoTitle       String?
  seoDescription String?
  canonicalUrl   String?
  version        Int      @default(1)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  product        Product  @relation(fields: [productId], references: [id])

  @@unique([productId, locale])
  @@unique([slug, locale])
  @@index([productId])
  @@index([locale])
}

model ProductImage {
  id        Int     @id @default(autoincrement())
  productId Int
  url       String
  alt       String?
  width     Int?
  height    Int?
  position  Int?
  product   Product @relation(fields: [productId], references: [id])

  @@index([productId])
  @@index([position])
}

model Testimonial {
  id         Int      @id @default(autoincrement())
  clientName String
  profession String
  review     String
  imageUrl   String
  isActive   Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([createdAt])
  @@index([isActive])
}

model YouTubeVideo {
  id           Int                       @id @default(autoincrement())
  youtubeLink  String
  brandId      Int
  isActive     Boolean                   @default(true)
  createdAt    DateTime                  @default(now())
  updatedAt    DateTime                  @updatedAt
  brand        Brand                     @relation(fields: [brandId], references: [id])
  translations YouTubeVideoTranslation[]
  categories   Category[]                @relation("YouTubeVideoCategories")
  tags         Tag[]                     @relation("YouTubeVideoTags")
  images       YouTubeVideoImage[]

  @@index([youtubeLink])
  @@index([brandId])
  @@index([isActive])
}

model YouTubeVideoTranslation {
  id             Int          @id @default(autoincrement())
  youtubeVideoId Int
  locale         String
  name           String
  description    String
  seoTitle       String?
  seoDescription String?
  canonicalUrl   String?
  version        Int          @default(1)
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  youtubeVideo   YouTubeVideo @relation(fields: [youtubeVideoId], references: [id], onDelete: Cascade)

  @@unique([youtubeVideoId, locale])
  @@index([locale])
}

model YouTubeVideoImage {
  id             Int          @id @default(autoincrement())
  youtubeVideoId Int
  url            String
  alt            String?
  width          Int?
  height         Int?
  position       Int?
  youtubeVideo   YouTubeVideo @relation(fields: [youtubeVideoId], references: [id], onDelete: Cascade)

  @@index([youtubeVideoId])
}

model ContactSubmission {
  id           Int      @id @default(autoincrement())
  name         String
  email        String
  phone        String?
  subject      String?
  message      String
  customFields String?  @db.Text
  isRead       Boolean  @default(false)
  createdAt    DateTime @default(now())

  @@index([createdAt])
  @@index([email])
  @@index([isRead])
}

model User {
  id                  Int               @id @default(autoincrement())
  email               String            @unique
  password            String
  name                String?
  roleId              Int
  status              UserStatus        @default(ACTIVE)
  refreshToken        String?
  mfaEnabled          Boolean           @default(false)
  mfaSecret           String?
  passwordChangedAt   DateTime?
  failedLoginAttempts Int               @default(0)
  lockedUntil         DateTime?
  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt
  otps                Otp[]
  sessions            Session[]
  passwordHistory     PasswordHistory[]
  role                Role              @relation(fields: [roleId], references: [id])

  @@index([roleId])
  @@index([status])
  @@index([email])
}

model Otp {
  id        Int      @id @default(autoincrement())
  userId    Int
  code      String
  type      OtpType  @default(PASSWORD_RESET)
  expiresAt DateTime
  isUsed    Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([expiresAt])
}

model Session {
  id         String            @id @default(cuid())
  userId     Int
  tokenId    String            @unique
  deviceInfo Json?
  ipAddress  String?
  userAgent  String?
  location   String?
  isActive   Boolean           @default(true)
  isCurrent  Boolean           @default(false)
  lastUsed   DateTime          @default(now())
  expiresAt  DateTime
  createdAt  DateTime          @default(now())
  updatedAt  DateTime          @updatedAt
  user       User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  activities SessionActivity[]

  @@index([userId])
  @@index([tokenId])
  @@index([expiresAt])
  @@index([isActive])
}

model SessionActivity {
  id        Int      @id @default(autoincrement())
  sessionId String
  action    String
  ipAddress String?
  userAgent String?
  details   Json?
  createdAt DateTime @default(now())
  session   Session  @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@index([sessionId])
  @@index([action])
  @@index([createdAt])
}

model Role {
  id          Int              @id @default(autoincrement())
  name        String           @unique
  description String?
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  users       User[]
  permissions RolePermission[]
}

model Permission {
  id          Int              @id @default(autoincrement())
  name        String           @unique
  resource    String           // e.g., 'user', 'product', 'role'
  action      String           // e.g., 'create', 'read', 'update', 'delete'
  description String?
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  roles       RolePermission[]

  @@unique([resource, action])
  @@index([resource])
  @@index([action])
}

model RolePermission {
  id           Int        @id @default(autoincrement())
  roleId       Int
  permissionId Int
  role         Role       @relation(fields: [roleId], references: [id], onDelete: Cascade)
  permission   Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade)
  createdAt    DateTime   @default(now())

  @@unique([roleId, permissionId])
  @@index([roleId])
  @@index([permissionId])
}

model Menu {
  id    Int    @id @default(autoincrement())
  name  String
  items Json
}

model CsrfToken {
  id        Int      @id @default(autoincrement())
  token     String   @unique
  sessionId String?
  userId    Int?
  expiresAt DateTime
  createdAt DateTime @default(now())

  @@index([token])
  @@index([sessionId])
  @@index([userId])
  @@index([expiresAt])
}

model SeoLazyLoadingSettings {
  id               Int      @id @default(autoincrement())
  enabled          String   @default("disable") // 'enable' or 'disable'
  whereToApply     String   @default("all-images")
  metaKeywords     String?
  preloadThreshold String?
  loadingAttribute String   @default("lazy") // 'lazy', 'eager', 'auto'
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
}

model SeoSectionLazyLoading {
  id               Int      @id @default(autoincrement())
  sectionId        Int      @unique
  enabled          Boolean  @default(false)
  loadingAttribute String   @default("lazy") // 'lazy', 'eager', 'auto'
  preloadThreshold String?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  section          Section  @relation(fields: [sectionId], references: [id], onDelete: Cascade)

  @@index([sectionId])
}

model GlobalSeo {
  id                     Int      @id @default(autoincrement())
  siteName               String   @db.VarChar(255)
  defaultTitle           String   @db.VarChar(60)
  defaultDescription     String   @db.VarChar(160)
  defaultKeywords        String   @db.Text
  googleSiteVerification String?  @db.VarChar(255)
  bingSiteVerification   String?  @db.VarChar(255)
  robotsTxt              String?  @db.Text
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt
}

model PageSeo {
  id              Int      @id @default(autoincrement())
  pageId          Int      @unique
  metaTitle       String   @db.VarChar(60)
  metaDescription String   @db.VarChar(160)
  metaKeywords    String?  @db.Text
  canonicalUrl    String?  @db.VarChar(500)
  robots          String   @default("index, follow") @db.VarChar(50)
  structuredData  Json?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  page            Page     @relation(fields: [pageId], references: [id], onDelete: Cascade)

  @@index([pageId])
}

model AuditLog {
  id           Int      @id @default(autoincrement())
  userId       Int? // User who performed the action (null for system actions)
  action       String // Action performed (e.g., USER_CREATED, USER_DELETED, LOGIN_SUCCESS)
  resource     String? // Resource affected (e.g., User, Product, Role)
  resourceId   Int? // ID of the resource affected
  details      Json? // Additional details about the action (sanitized)
  ipAddress    String? // IP address of the user
  userAgent    String? // User agent string
  status       String   @default("SUCCESS") // SUCCESS, FAILURE, ERROR
  errorMessage String? // Error message if status is FAILURE or ERROR
  createdAt    DateTime @default(now())

  @@index([userId])
  @@index([action])
  @@index([resource])
  @@index([resourceId])
  @@index([status])
  @@index([createdAt])
}

enum CategoryType {
  VIDEO
  PRODUCT
}

enum VideoType {
  VIDEO
  PLAYLIST
}

enum UserRole {
  ADMIN
  USER
}

enum OtpType {
  PASSWORD_RESET
  EMAIL_VERIFICATION
  TWO_FACTOR_AUTH
  ACCOUNT_RECOVERY
}

enum TagType {
  VIDEO
  PRODUCT
}

model PasswordHistory {
  id        Int      @id @default(autoincrement())
  userId    Int
  password  String // Hashed password
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([createdAt])
}

enum UserStatus {
  ACTIVE
  INACTIVE
}
